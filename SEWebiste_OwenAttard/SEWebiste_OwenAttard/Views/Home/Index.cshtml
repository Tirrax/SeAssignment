@using System.Runtime.InteropServices
@model List<SEWebiste_OwenAttard.Models.ProductModels>
@{
    ViewBag.Title = "Home Page";
}

   <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script type="text/javascript">
        $(function () {

            var chat = $.connection.notifyHub;

            // Start the connection.
            $.connection.hub.start().done(function () {
                //Calls the notify method of the server
                chat.server.notify($('#displayname').val(), $.connection.hub.id);
            });


            // Create a function that the hub can call to broadcast chat messages.
            chat.client.broadcastMessage = function (List) {
                var listview = $("#listView")[0];

                listview.innerHTML = "";
                var innerhtml = "";

                for (var i = 0; i < List.length; i++) {

                    innerhtml += "<div class=\"row\">" +
                        "<div class=\"span2\">" +
                        "<img src=\"" + List[i].ImgPath + "\" />" +
                        "</div>" +
                        "<div class=\"span4\">" +
                        "<h3>" + List[i].Name + "</h3>" +
                        "<hr class=\"soft\"/>" +
                        "<p>" +
                        "" + List[i].Desc + "" +
                        "</p>" +
                        "<br class=\"clr\"/>" +
                        "</div>" +
                        "<div class=\"span3 alignR\">" +
                        "<form class=\"form-horizontal qtyFrm\">" +
                        "<h3> €" + List[i].price + "</h3>" +
                        "<a onclick=\"AddToCart(" + List[i].ID + ")\" class=\"btn btn-large btn-primary\"> Add to <i class=\" icon-shopping-cart\"></i></a>" +
                        "</form>" +
                        "<a class=\"btn btn-info btn-large pull-right\" href=\"/Products/ProductDetail/" + List[i].ID + "\">View Details</a>" +
                        "</div>" +
                        "</div>  " +
                        "<hr class=\"soft\"/>";


                }

                listview.innerHTML = innerhtml;

            };

            chat.client.disconnected = function (name) {
                
            };

        });

        function AddToCart(ID) {
            $.ajax({
                url: '@Url.Action("AddToCart", "Products")',
            type: 'POST',
            data:
                {
                    'ProductID': ID,
                    'Qty': 1,
                },
            dataType: "json",
            success: function (data) {
                if (data.result == "Success") {
                    UpdateCart();

                }
                else {
                }
            },
            error: function (req, status, error) {
                alert("R: " + req + " S: " + status + " E: " + error);
            }
        });

    }
    </script>


    <h1>Latest Products </h1>
    <hr class="soft"/> 

    <div class="tab-pane active" id="listView" >
        
        
        @foreach (var curModel in Model)
        {
             <div class="row">	  
                <div class="span2">
                    <img src="@curModel.ImgPath" alt=""/>
                </div>
                <div class="span4">
                    <h3>@curModel.Name</h3>				
                    <hr class="soft"/>
                    <p>
                        @curModel.Desc
                    </p>
                        
                        
                    <br class="clr"/>
                </div>
                <div class="span3 alignR">
                    <form class="form-horizontal qtyFrm">
                        <h3> €@curModel.price</h3>
                        <a onclick="AddToCart(@curModel.ID)" class="btn btn-large btn-primary"> Add to <i class=" icon-shopping-cart"></i></a>
                            
                    </form>
                    <a class="btn btn-info btn-large pull-right" href="/Products/ProductDetail/@curModel.ID">View Details</a>
                </div>
            </div>  
            <hr class="soft"/>  
        }
                  
    </div>


  
