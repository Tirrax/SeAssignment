@using System.Runtime.InteropServices
@model List<SEWebiste_OwenAttard.Models.ProductModels>
@{
    ViewBag.Title = "Home Page";
}

   <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script type="text/javascript">
        $(function () {

            var chat = $.connection.notifyHub;

            // Start the connection.
            $.connection.hub.start().done(function () {
                //Calls the notify method of the server
                chat.server.notify($('#displayname').val(), $.connection.hub.id);
            });


            // Create a function that the hub can call to broadcast chat messages.
            chat.client.broadcastMessage = function (List) {
                var listview = $("#listView");

                listview.clear();

                
                var innerhtml = "";

                for (var i = 0; i < List.length; i++) {

                    innerhtml += "<li class=\"span3\">" +
                        "<div class=\"thumbnail\">" +
                        "<a style=\"height: 200px; width: 95%\" href=\"/Products/ProductDetail/" + List[i].ID + "\">" +
                        "<img src=\"" + List[i].ImgPath + "\"  /></a>" +
                        "<div class=\"caption\">" +
                        "<h5>" + List[i].Name + "</h5>" +
                        "<h4 style=\"text-align: center\"><a class=\"btn\" onclick=\"AddToCart(" + List[i].ID + ")\">Add to <i class=\"icon-shopping-cart\"></i></a> <span class=\"btn-price\" >€" + List[i].price + "</span> </h4>" +
                        "</div>" +
                        "</div>" +
                        "</li>";


                }

                listview.innerHTML = innerhtml;

            };

            chat.client.disconnected = function (name) {
                
            };

        });

        function AddToCart(ID) {
            $.ajax({
                url: '@Url.Action("AddToCart", "Products")',
            type: 'POST',
            data:
                {
                    'ProductID': ID,
                    'Qty': 1,
                },
            dataType: "json",
            success: function (data) {
                if (data.result == "Success") {
                    UpdateCart();

                }
                else {
                }
            },
            error: function (req, status, error) {
                alert("R: " + req + " S: " + status + " E: " + error);
            }
        });

    }
    </script>


    <h1>Latest Products </h1>
    <hr class="soft"/> 

    <ul class="thumbnails" id="listview">
        @foreach (var curModel in Model)
        {
            <li class="span3">
                <div class="thumbnail">
                    <a style="height: 200px; width: 95%" href="/Products/ProductDetail/@curModel.ID">
                        <img src="@curModel.ImgPath" alt="" /></a>
                    <div class="caption">
                        <h5>@curModel.Name</h5>

                        <h4 style="text-align: center"><a class="btn" onclick="AddToCart(@curModel.ID)">Add to <i class="icon-shopping-cart"></i></a> <span class="btn-price" >€@curModel.price</span> </h4>
                    </div>
                </div>
            </li>
        }
    </ul>
                  
  


  
